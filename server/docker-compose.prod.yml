version: '3.8'

services:
  api:
    volumes: 
      - /app/node_modules  # node_modules만 유지
    command: >
      sh -c "
        npm run db:migrate || true &&
        npm run start:prod
      "
    restart: unless-stopped

  collector:
    command: npm run collect:prod
    restart: unless-stopped

  postgres:
    image: postgres:15-alpine
    restart: unless-stopped 